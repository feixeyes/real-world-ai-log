# Agent 的上下文工程：一套正在形成事实标准的目录结构

> 目标：写一篇“可复用、可操作”的实践型文章：解释为什么会收敛、每个文件写什么、给最小模板、给更新机制，并用我们最近的公众号自动化链路作为案例。

## TL;DR（开头先给结论）
- `soul/user/skills/memory` 不是玄学：它们分别对应 **价值观与行事原则 / 用户偏好与边界 / 可调用能力 / 可持续的连续性**。
- 这套结构能带来三件事：**可维护（版本化）**、**可迁移（换工具不崩）**、**可审计（失败可复盘）**。
- 真正的难点不是“写”，而是“更新”：把触发条件写清楚。

## 1. 开头：为什么会出现“神奇巧合”？
- 现象：不同人、不同场景（写作/开发/知识管理）最终都落到相似的文件结构。
- 解释：Agent 的产出质量 = 模型能力 × 上下文质量；上下文质量需要工程化。
- 反直觉：不是“给更多上下文就更好”，而是“给对位置的上下文”。

## 2. 四个文件分别解决什么问题（+ 反例）
### 2.1 soul.md：你想让它成为什么样的协作者
- 写什么：风格、原则、边界、价值判断方式（比如“允许失败但不允许含糊”）。
- 不写什么：一次性的任务信息、具体账号密码。
- 没有它会怎样：每次输出都像随机抽卡；越用越“跑偏”。

### 2.2 user.md：它在服务谁（偏好、禁忌、作息）
- 写什么：称呼、语气、禁忌、作息（quiet hours）、对外发送需确认等。
- 没有它会怎样：轻则烦人，重则越界（比如夜里推送、擅自对外发消息）。

### 2.3 skills.md / skills/：它到底能做什么（以及怎么做）
- 写什么：可复用动作的接口、参数、失败处理；把“会做”变成“可调用”。
- 对比：脚本 vs skill vs MCP（点到为止，留给后续文章）。
- 没有它会怎样：每次都要重新解释流程，无法积累。

### 2.4 memory.md：连续性与状态（不是“聊天记录备份”）
- 写什么：长期有效的决策、路径、偏好、TODO、踩坑总结。
- 写入触发条件：
  - 做了关键决策
  - 找到稳定方案
  - 明确偏好/边界
  - 发现长期隐患
- 没有它会怎样：换一个会话就失忆，反复踩同一个坑。

## 3. 事实标准背后的工程约束（为什么会收敛）
- 可维护：文本文件可 diff、可 review、可版本化。
- 可迁移：换模型/换工具时，上下文不丢。
- 可审计：失败可回放（截图/日志/commit 记录）。
- 安全：敏感信息隔离（cookies/凭证不进 repo）。

## 4. 最小可用模板（给读者抄作业）
给一份“10 分钟搭建版”目录：
- `SOUL.md`
- `USER.md`
- `SKILLS.md`（或 `skills/` 目录说明）
- `MEMORY.md`
- （可选）`HEARTBEAT.md`（定期检查清单）

每个文件 5 行以内的最小样例（文中给代码块）。

## 5. 更新机制：把它变成系统（而不是一次性文档）
- 每次任务结束问 3 个问题：
  1) 哪个判断标准被反复用到？→ soul
  2) 哪个偏好/禁忌被触发？→ user
  3) 哪个步骤可复用/可自动化？→ skills
  4) 哪个坑以后不能再踩？→ memory
- 节奏建议：
  - daily：快速记 3 行
  - weekly：把 daily 蒸馏进 memory
  - monthly：做一次“系统复盘”（呼应 /insights）

## 6. 真实案例：我们如何用这套结构跑通「X → 公众号草稿箱（含图片）」
- 约束：无 GUI、cookie 注入、素材库、草稿箱、图片插入。
- 产物沉淀：
  - scripts（Playwright）
  - .docs/workflows（操作说明）
  - progress 月志（过程可见）
  - memory（关键决策与 TODO）
- 关键一句：让“这次跑通”变成“下次一条命令就能复现”。

## 7. 结尾：下一篇要写什么
- 用这套上下文系统跑一次“新文章从 0 到草稿箱”的全链路（选题→大纲→草稿→配图→草稿箱）。
- 邀请读者：把自己的四文件模板贴出来对照。

## 备用标题（如果要更“公众号味”）
- 你以为是巧合，其实是必然：Agent 的上下文系统正在形成行业默认配置
- 用 Agent 写作/开发的人，最后都会长出同一套目录结构
