# 构建 Agent 需要关注的 5 个问题：我用一次「X → 公众号草稿箱」把流程串起来

很多 Agent 的问题不是“跑不起来”，而是：

- 不稳定（同一句话、不同次运行结果差很远）
- 不可控（说着说着就越权/跑偏/做多了）
- 不可交付（能演示，但很难变成一个可复用的流程）

这几天我做了一个很具体的任务：

> 从 X（x.com）的 “For you” feed 里抓最新的 20 条内容 → 总结 → 把文章草稿放进微信公众号后台的草稿箱。

它不是什么“大而全的 Agent”，但它足够真实：有登录、有权限、有工具链、有失败点。

更重要的是：当我把这个任务跑通后，我发现自己在脑子里反复做的判断，其实可以浓缩成 **5 个必须回答的问题**。

这篇文章不是教你“怎么写 prompt”。我想做的是：用一次真实端到端例子，把“造一个可用 Agent”需要先想清楚什么，尽量说透。

---

## 1）先别急着写：这个 Agent 到底要完成什么？（产品形态先行）

如果我只说“帮我总结一下 X”，那几乎注定会出现分歧：

- 你说的“总结”是给谁看的？是给自己复盘，还是要转发到群里？
- 你要的是观点提炼，还是信息清单？
- 你希望它“尽量全面”，还是“尽量短”？

所以我在一开始就把输出拆成了几个**可交付的工件（artifacts）**：

1. **1 分钟速读版**（可转发）
2. **前 20 条明细列表**（带链接、作者、时间、互动）
3. **公众号草稿箱里的文章草稿**（不是直接发布，只保存草稿）

然后把成功标准写清楚：

- 必须能复核（能看到原链接/明细，而不是纯“主观总结”）
- 必须可重复（下次再跑，流程还成立）
- 必须可停（任何可能越权/不可逆的动作，都要等我确认）

这一步对应我后来总结出的第 5 个问题：**产品形态**。

你在做 Agent 时，最容易忽略的是：你以为你在做“智能”，但用户真正感知到的是：

- 我看到了什么？
- 我能校验吗？
- 我能控制它停下来吗？

---

## 2）问题 1：会问——意图、输入、边界、职责、上下文

我越来越相信：一个 Agent 的上限，取决于它“会不会问”。

在这个例子里，我最需要对齐的 5 类问题是：

### 2.1 意图（Intent）
- 你要这份总结用来干嘛？转发？写文章？做决策？
- 你想要“中立摘要”还是“我的观点”？

### 2.2 输入（Input）
- “For you 最新 20 条”是按时间，还是按我看到的顺序？
- 要不要过滤：广告、体育、无关内容、转推？

（这次我选择：先不做过滤，先保证“抓得到、列得清”。）

### 2.3 边界（Boundary）
- 需不需要登录？
- 登录凭证怎么传？（cookie、扫码、账号密码？）
- 哪些动作是不可逆的（发布、删除、改配置）？哪些必须确认？

这次我们遇到的现实是：服务器没图形桌面，只能走 cookie 注入；而且“命令执行”还卡过一次审批配置。

### 2.4 职责（Responsibility）
- 我负责：抓取、整理、生成草稿、把流程写清楚
- 你负责：判断内容是否值得写、是否需要过滤、是否进入下一步（比如真的发布）

### 2.5 上下文（Context）
- 这是一次性任务，还是要沉淀成“以后每次都能用的流程”？
- 产物要落在哪个 repo、哪个目录？文件命名怎么约束？

这一步看似“啰嗦”，但它能直接减少后面 80% 的返工。

---

## 3）问题 2：闭环流程——意图识别 → 规划 → action → 校验 → 反思

很多 Agent 做不稳定，我的经验是：不是模型不行，而是流程没有闭环。

我现在会强制自己（也强制 Agent）走一条最短闭环：

1. **意图识别**：把任务说清楚（上一节）
2. **规划**：先给出执行方案与输出格式
3. **Action**：执行抓取/处理
4. **校验**：检查结果是否满足“数量、格式、可复核”
5. **反思**：这次卡在哪？怎么固化到系统里？

在这次例子里，最典型的两个“校验点”是：

- 我说要“最新 20 条”，那就必须真的给到 20 条，并且每条有链接
- 我说要“进入公众号草稿箱”，那就必须真的能打开 mp.weixin.qq.com 后台并保存草稿

而最典型的“反思点”是：

- 服务器上跑命令需要审批，但审批入口不在聊天里 → 这会导致流程卡死
- x.com / 微信后台都需要登录态 → cookie 注入是一个必须固化的能力

反思不是写在心里，而是写进文件、写进脚本、写进技能。

---

## 4）问题 3：上下文与记忆——分层、分组、压缩、固化

做 Agent 时，“上下文”是空气。

你看不到它，但它决定了一切：

- 它知道当前项目是什么吗？
- 它知道你不想要什么吗？
- 它知道哪些事情不能自动做吗？

我这次把上下文分成了三层：

### 4.1 项目层（Project）
例如在 `real-world-ai-log` 这个 repo 里：

- 写作原则：实践优先、过程可见、AI 执行人判断、不装权威
- 目录结构：ideas → outlines → drafts → published
- 文件命名：英文、小写、连字符（历史中文文件名先不强行清洗）

这些东西适合固化在仓库里（README/AGENTS/NAMING 等）。

### 4.2 会话层（Session）
这次具体要做的事：

- 抓 X 的 For you 最新 20 条
- 输出两种总结
- 把草稿放进公众号后台草稿箱

会话层的信息不一定值得长期保存，但关键的“流程与卡点”值得沉淀。

### 4.3 长期层（Long-term）
真正值得长期保留的往往是：

- 以后会反复用到的路径/配置（workspace 在哪）
- 关键的权限打通方式（cookie 注入）
- 一次踩坑后的经验（审批入口在哪里、怎么避免卡死）

我的一个硬规则是：

> 想让 Agent “记住”，不要依赖模型记忆，而是写成文件。

在这次流程里，我们就把关键事实写进了项目的 memory 文件和仓库结构里。

---

## 5）问题 4：模型能力——动态规划、工具调用、动态生成工具（与边界）

当你开始做 Agent，你很容易对“模型能做什么”产生幻想。

我的现实经验是：模型的能力很强，但它的强项不是“凭空把事情做成”，而是：

- 把一个模糊任务拆成可执行的步骤
- 在工具和约束下做选择（比如：无桌面 → cookie 注入 → Playwright）
- 在每一步产出可复核的中间结果

但它不应该做的也很明确：

- 不经确认就发布内容
- 通过猜测补齐缺失的事实
- 把“临时成功”当成“稳定能力”

这次例子里，我们临时写了 Playwright 脚本来抓 X、注入 cookie、验证登录。

下一步要做的不是继续堆脚本，而是决定：哪些脚本值得“升格”为技能（skill），让它可复用、可维护、可审计。

一个简单判断标准：

- 这件事会不会做第二次？
- 第二次还会不会卡在同一个地方？

如果答案是“会”，那就值得固化。

---

## 6）收束：把一次成功变成可复用的“最小 Agent 模板”

如果让我把这次经验压缩成一个最小模板，我会写成四块：

### 6.1 五个问题（Checklist）
1) 会问吗？（意图/输入/边界/职责/上下文）
2) 有闭环吗？（识别→规划→action→校验→反思）
3) 上下文/记忆怎么分层与固化？
4) 模型能力边界是什么？哪些必须工具化？
5) 产品形态是什么？用户看到什么、怎么复核、怎么控制？

### 6.2 运行闭环（Loop）
每次任务必须产出中间工件，并且能停下来等待确认。

### 6.3 工件清单（Artifacts）
- 原始来源链接（可追溯）
- 结构化明细（可校验）
- 可转发摘要（可传播）
- 草稿箱草稿（可交付）

### 6.4 风险与权限清单（Ops）
- 登录态怎么拿到、怎么存放、怎么失效
- 哪些操作需要确认
- 哪些失败模式要自动识别并停止

---

## 下一步（这次我准备怎么继续迭代）

到这里为止，我不想把这件事吹成“未来已来”。

我更关心的是：能不能把这条链路做成一个可复用的工作流，同时保留关键的人类检查点。

下一步我会做两件小事：

1) 把“X → 总结”的输出格式固化成模板（减少每次重复对齐）
2) 把“保存到公众号草稿箱”的流程跑通并写成可复用脚本/skill（并解决权限与登录的稳定性）

慢一点，但是真的。
